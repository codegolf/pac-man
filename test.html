<!DOCTYPE HTML>
<pre>Loading...</pre>
<span id="points">0</span> points
<style type="text/css">
  body { background: #000; color: #FFF; font-family: Consolas, monospace; margin: 4em; text-shadow: 0 0 0.2em #FFF; }
  pre { font-size: 4em; line-height: 0.55em; margin: 0; }
  .air { color: #222; text-shadow: 0 0 0.2em #222; }
  .wall { color: #30F; text-shadow: 0 0 0.2em #30F; }
  .player { color: #FE0; text-shadow: 0 0 0.2em #FE0; }
  #points { font-size: 2em; line-height: 2em; }
</style>
<script>
// 138 bytes
var getFirstElement = function(a)
{
  a = /([#.]?)(.*)/.exec(a || '*');
  a = document['getElement' + (a[1] > '-' ? 'sByClassName' : a[1] ? 'ById' : 'sByTagName')](a[2]);
  return a[0] || a
}
// 97 bytes, maybe use the remaining 43 bytes to make this more flexible?
var parseLevel = function(l, w)
{
  l = l.join ? l.join('\n') : l;  //if it's an Array of rows
  w = l.indexOf('\n') + 1;        //calculate row length
  l = l.split('');                //convert to character array
  l.w = w;                        //width
  l.d = l.p = 0;                  //walking direction and points
  return l
}
// 138 bytes
var renderLevel = function(l, t)  //level and theme objects
{
  for (var h = '', g = x = 0; x < l.length; x++)
  {
    g += l[x] == '.';             //count gold
    if (l[x] == 'P') l.x = x;     //store player position
    h += t[l[x]] ? t[l[x]] : l[x] //theme is optional
  }
  if (!g) h += '\n\nYou win!';
  return h
}
// 140 bytes
var updateLevel = function(l, k)
{
  l[l.x] = ' ';
  if (l[l.x + l.d] == '#')
    l.d = 0;
  if (k > 36 && k < 41 && l[l.x + (k = k % 2 ? k - 38 : (k - 39) * l.w)] != '#')
    l.d = k;
  l.p += l[l.x += l.d] == '.';
  l[l.x] = 'P'
}
var theme = {
  ' ': '<span class="air">\u2219</span>',
  '.': '<span class="gold">\u2219</span>',
  '#': '<span class="wall">\u25A1</span>',
  'P': '<span class="player">\u263B</span>'
};
var level = parseLevel(
  '###################\n' +
  '#....#.......#....#\n' +
  '#.##.#.#####.#.##.#\n' +
  '#.#.............#.#\n' +
  '#.#.##.##.##.##.#.#\n' +
  '#......#...#......#\n' +
  '#.#.##.#####.##.#.#\n' +
  '#.#......P......#.#\n' +
  '#.##.#.#####.#.##.#\n' +
  '#....#.......#....#\n' +
  '###################');
window.onkeydown = function(e)
{
  level.keyCode = (e || window.event).keyCode;
}
window.setInterval(function()
{
  getFirstElement('PRE').innerHTML = renderLevel(level, theme);
  getFirstElement('#points').innerHTML = level.p;
  updateLevel(level, level.keyCode);
}, 250)
</script>